# Copyright 2024 Kelly Helmut Lord
# SPDX-License-Identifier: Apache-2.0

description: |
  Input double tap pseudo-device

  Listens for key events as an input and translates them to different key events
  as output, distinguishing between single and double taps. Each input code maps
  to a corresponding double-tap code (and optionally a single-tap code) in the
  output.

  When an input key is pressed, the device waits for the configured delay period.
  If a second press occurs within this window, a double-tap event is generated.
  If the delay expires without a second press and single-tap-codes are configured,
  a single-tap event is generated instead.

  Can optionally be associated to a specific device to listen for events only
  from that device.

  Example configuration:

  #include <zephyr/dt-bindings/input/input-event-codes.h>

  double_tap {
          input = <&buttons>;
          compatible = "zephyr,input-double-tap";
          input-codes = <INPUT_KEY_0>, <INPUT_KEY_1>;
          double-tap-codes = <INPUT_KEY_A>, <INPUT_KEY_B>;
          single-tap-codes = <INPUT_KEY_X>, <INPUT_KEY_Y>;
          double-tap-delay-ms = <300>;
  };

  Example output:

  # single tap (with single-tap-codes configured)
  input event: dev=buttons          SYN type= 1 code= 11 value=1 # INPUT_KEY_0 press
  input event: dev=buttons          SYN type= 1 code= 11 value=0 # INPUT_KEY_0 release
  # wait for double-tap-delay-ms (300ms) without second press
  input event: dev=double_tap       SYN type= 1 code= 45 value=1 # INPUT_KEY_X press
  input event: dev=double_tap       SYN type= 1 code= 45 value=0 # INPUT_KEY_X release

  # double tap
  input event: dev=buttons          SYN type= 1 code= 11 value=1 # INPUT_KEY_0 press
  input event: dev=buttons          SYN type= 1 code= 11 value=0 # INPUT_KEY_0 release
  # second press within double-tap-delay-ms (300ms)
  input event: dev=buttons          SYN type= 1 code= 11 value=1 # INPUT_KEY_0 press
  input event: dev=double_tap       SYN type= 1 code= 30 value=1 # INPUT_KEY_A press
  input event: dev=double_tap       SYN type= 1 code= 30 value=0 # INPUT_KEY_A release

compatible: "zephyr,input-double-tap"

properties:
  input:
    type: phandle
    description: |
      Input device phandle, if not specified listen for input from all devices.

  input-codes:
    type: array
    required: true
    description: |
      Array of input event key codes (INPUT_KEY_* or INPUT_BTN_*).

  double-tap-codes:
    type: array
    required: true
    description: |
      Array of key codes to be generated for double taps (INPUT_KEY_* or INPUT_BTN_*).

  single-tap-codes:
    type: array
    description: |
      Optional array of key codes to be generated for single taps
      (INPUT_KEY_* or INPUT_BTN_*). If present, a single tap event is
      reported when the double tap delay expires without a second tap.

  double-tap-delay-ms:
    type: int
    required: true
    description: Maximum time delay between taps to register a double tap, in milliseconds.
