# Copyright 2024 Kelly Helmut Lord
# SPDX-License-Identifier: Apache-2.0

description: |
  Input double tap pseudo-device

  Transforms key press events into distinct events for single and double taps.
  Listens for key events from an input device and generates output events based
  on tap patterns within a configurable time window.

  Can optionally be associated to a specific device to listen for events
  only from that device.

  Example configuration:

  #include <zephyr/dt-bindings/input/input-event-codes.h>

  double_tap {
          input = <&buttons>;
          compatible = "zephyr,input-double-tap";
          input-codes = <INPUT_KEY_0>, <INPUT_KEY_1>;
          double-tap-codes = <INPUT_KEY_A>, <INPUT_KEY_B>;
          single-tap-codes = <INPUT_KEY_C>, <INPUT_KEY_D>;
          double-tap-delay-ms = <300>;
  };

  Example output:

  # double tap
  input event: dev=buttons          SYN type= 1 code= 11 value=1 # INPUT_KEY_0 press
  input event: dev=buttons          SYN type= 1 code= 11 value=0 # INPUT_KEY_0 release
  # second press within 300ms
  input event: dev=buttons          SYN type= 1 code= 11 value=1 # INPUT_KEY_0 press
  input event: dev=double_tap       SYN type= 1 code= 30 value=1 # INPUT_KEY_A press
  input event: dev=double_tap       SYN type= 1 code= 30 value=0 # INPUT_KEY_A release

  # single tap (when single-tap-codes is configured)
  input event: dev=buttons          SYN type= 1 code= 11 value=1 # INPUT_KEY_0 press
  input event: dev=buttons          SYN type= 1 code= 11 value=0 # INPUT_KEY_0 release
  # no second press within 300ms
  input event: dev=double_tap       SYN type= 1 code= 47 value=1 # INPUT_KEY_C press
  input event: dev=double_tap       SYN type= 1 code= 47 value=0 # INPUT_KEY_C release

compatible: "zephyr,input-double-tap"

properties:
  input:
    type: phandle
    description: |
      Input device phandle, if not specified listen for input from all devices.

  input-codes:
    type: array
    required: true
    description: |
      Array of input event key codes (INPUT_KEY_* or INPUT_BTN_*).

  double-tap-codes:
    type: array
    required: true
    description: |
      Array of key codes to be generated for double taps (INPUT_KEY_* or INPUT_BTN_*).

  single-tap-codes:
    type: array
    description: |
      Array of key codes to be generated for single taps (INPUT_KEY_* or INPUT_BTN_*).
      If specified, a single tap event is generated when a tap is not followed by
      a second tap within the double-tap-delay-ms window.

  double-tap-delay-ms:
    type: int
    required: true
    description: Maximum time delay between taps to register a double tap, in milliseconds.
